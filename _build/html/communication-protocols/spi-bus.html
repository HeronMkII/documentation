

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>SPI Bus &mdash; UTAT Space Systems Documentation 1.0 documentation</title>
  

  
  
  
  

  

  
  
    

  

  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Using our SPI Library" href="spi-using-spi.html" />
    <link rel="prev" title="SPI (Serial Peripheral Interface)" href="spi.html" /> 

  
  <script src="../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../index.html" class="icon icon-home"> UTAT Space Systems Documentation
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Getting Started</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../getting-started/rtsys.html">Real-Time Embedded Systems</a></li>
<li class="toctree-l1"><a class="reference internal" href="../getting-started/avr-toolchain.html">The AVR Toolchain</a></li>
<li class="toctree-l1"><a class="reference internal" href="../getting-started/install.html">Software Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../getting-started/install-mac.html">Software Installation - macOS</a></li>
<li class="toctree-l1"><a class="reference internal" href="../getting-started/install-win.html">Software Installation - Windows</a></li>
<li class="toctree-l1"><a class="reference internal" href="../getting-started/install-linux.html">Software Installation - Linux</a></li>
<li class="toctree-l1"><a class="reference internal" href="../getting-started/atmega32m1.html">The ATMega32M1 Microcontroller</a></li>
<li class="toctree-l1"><a class="reference internal" href="../getting-started/hello-world.html">Hello World ATMega32M1</a></li>
<li class="toctree-l1"><a class="reference internal" href="../getting-started/git-and-github.html">Git and Github</a></li>
</ul>
<p class="caption"><span class="caption-text">Software and Programming</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="../software-and-programming.html">Software and Programming</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../software-tools/software-workflow.html">Software Workflow</a></li>
<li class="toctree-l2"><a class="reference internal" href="../software-tools/test-harness.html">Test Harness</a></li>
<li class="toctree-l2"><a class="reference internal" href="../software-tools/our_toolchain.html">Our Toolchain</a></li>
<li class="toctree-l2"><a class="reference internal" href="../software-tools/lib-common.html">lib-common</a></li>
<li class="toctree-l2"><a class="reference internal" href="../software-tools/lib-common.html#switch-lib-common-to-a-different-branch">Switch lib-common to a Different Branch</a></li>
<li class="toctree-l2"><a class="reference internal" href="../software-tools/uart-terminal.html">UART Terminal</a></li>
<li class="toctree-l2"><a class="reference internal" href="../troubleshooting/troubleshooting.html">Troubleshooting</a></li>
<li class="toctree-l2"><a class="reference internal" href="../embedded/microcontrollers.html">Microcontrollers</a></li>
<li class="toctree-l2"><a class="reference internal" href="../embedded/registers.html">Registers</a></li>
<li class="toctree-l2"><a class="reference internal" href="../embedded/interrupts.html">Interrupts</a></li>
<li class="toctree-l2"><a class="reference internal" href="../embedded/avr-fuses.html">AVR Fuses</a></li>
<li class="toctree-l2"><a class="reference internal" href="communication-protocols.html">Communication Protocols</a></li>
<li class="toctree-l2"><a class="reference internal" href="can.html">CAN (Controller Area Network)</a></li>
<li class="toctree-l2"><a class="reference internal" href="can-mobs.html">Message Objects (MObs)</a></li>
<li class="toctree-l2"><a class="reference internal" href="can-mob-allocation.html">MOb Allocation</a></li>
<li class="toctree-l2"><a class="reference internal" href="spi.html">SPI (Serial Peripheral Interface)</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">SPI Bus</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#sck-sclk-source-clock">SCK/SCLK (Source Clock)</a></li>
<li class="toctree-l3"><a class="reference internal" href="#mosi-master-out-slave-in">MOSI (Master Out Slave In)</a></li>
<li class="toctree-l3"><a class="reference internal" href="#miso-master-in-slave-out">MISO (Master In Slave Out)</a></li>
<li class="toctree-l3"><a class="reference internal" href="#cs-ss-chip-select-slave-select">CS/SS (Chip Select / Slave Select)</a></li>
<li class="toctree-l3"><a class="reference internal" href="#hardware-signal">Hardware Signal</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="spi-using-spi.html">Using our SPI Library</a></li>
<li class="toctree-l2"><a class="reference internal" href="uart.html">UART (Universal Asynchronous Receiver Transmitter)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../c-programming/introduction.html">C Programming</a></li>
<li class="toctree-l2"><a class="reference internal" href="../c-programming/variables.html">Variables</a></li>
<li class="toctree-l2"><a class="reference internal" href="../c-programming/operators.html">Operators</a></li>
<li class="toctree-l2"><a class="reference internal" href="../c-programming/bitwise-operators.html">Bitwise Operators</a></li>
<li class="toctree-l2"><a class="reference internal" href="../c-programming/control-structures.html">Control Structures</a></li>
<li class="toctree-l2"><a class="reference internal" href="../c-programming/functions.html">Functions</a></li>
<li class="toctree-l2"><a class="reference internal" href="../c-programming/header-files.html">Header Files</a></li>
<li class="toctree-l2"><a class="reference internal" href="../c-programming/header-files.html#define">#define</a></li>
<li class="toctree-l2"><a class="reference internal" href="../c-programming/header-files.html#typedef">typedef</a></li>
<li class="toctree-l2"><a class="reference internal" href="../c-programming/pointers.html">Pointers</a></li>
<li class="toctree-l2"><a class="reference internal" href="../c-programming/structs.html">Structs</a></li>
<li class="toctree-l2"><a class="reference internal" href="../c-programming/c_h_files.html"><code class="docutils literal"><span class="pre">.c</span></code> and <code class="docutils literal"><span class="pre">.h</span></code> Files</a></li>
<li class="toctree-l2"><a class="reference internal" href="../c-programming/binary-hex-literals.html">Binary (0b) and Hexadecimal (0x) Literals</a></li>
<li class="toctree-l2"><a class="reference internal" href="../c-programming/integer-types.html">Integer Types</a></li>
<li class="toctree-l2"><a class="reference internal" href="../c-programming/print-formatting.html">Print Formatting</a></li>
<li class="toctree-l2"><a class="reference internal" href="../c-programming/volatile-variables.html">Volatile Variables</a></li>
<li class="toctree-l2"><a class="reference internal" href="../style-guide/style-guide.html">Software Style Guide</a></li>
<li class="toctree-l2"><a class="reference internal" href="../style-guide/technical.html">Technical</a></li>
<li class="toctree-l2"><a class="reference internal" href="../style-guide/formatting.html">Formatting</a></li>
</ul>
</li>
</ul>
<p class="caption"><span class="caption-text">Electronics and Altium</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../electronics-and-altium.html">Electronics and Altium</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">UTAT Space Systems Documentation</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html">Docs</a> &raquo;</li>
        
          <li><a href="../software-and-programming.html">Software and Programming</a> &raquo;</li>
        
      <li>SPI Bus</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../_sources/communication-protocols/spi-bus.md.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="spi-bus">
<span id="spi-bus"></span><h1>SPI Bus<a class="headerlink" href="#spi-bus" title="Permalink to this headline">¶</a></h1>
<p>SPI is a synchronous serial communication protocol used to communicate between devices. SPI uses a master-slave architecture, with a single master device initiating the communication frame, and operates in full-duplex mode (data is sent and received at the same time).</p>
<p>In digital systems, data is transferred in the form of 1’s and 0’s. In hardware, 1’s and 0’s are represented as high and low voltages. Our satellite uses 3.3V, so a 1 corresponds to ~3.3V on a wire, and a 0 corresponds to ~0V.</p>
<p>SPI is a synchronous communication protocol, meaning data is timed with clock pulses. is sent and received at the same time. This means that two of the four lines (MOSI, MISO) are for data, and one of the lines (SCK) is for timing.</p>
<p>SPI uses four wires to communicate, which are referred to as the <em>SPI bus</em>. Three lines (SCK, MOSI, MISO) are shared between <em>all devices</em> on a SPI bus. The fourth line (CS/SS) is <em>unique to every slave device</em>, and all CS/SS lines are connected to the master device.</p>
<p>The master device always transmits a square wave on SCK (source clock) to synchronize all devices. To initiate communication, the master device sets CS/SS (chip select/slave select) low for a particular device. The master device sends data to the slave device on the MOSI (master out, slave in) line. At the same time, the slave device sends data to the master device on the MISO (master in, slave out) line. To stop communication, the master devices sets CS/SS high again.</p>
<p><img alt="Diagram of a general SPI bus" src="../_images/spi_bus.png" /></p>
<div class="section" id="sck-sclk-source-clock">
<span id="sck-sclk-source-clock"></span><h2>SCK/SCLK (Source Clock)<a class="headerlink" href="#sck-sclk-source-clock" title="Permalink to this headline">¶</a></h2>
<p>The clock keeps the data lines and devices in sync. The clock is an oscillating signal produced by the master device that tells the receiving device when to read the data. Depending on the device properties, data is either sent/received on the rising/falling edge of SCK. We will discuss this in more detail shortly. This line is shared by all slave devices.</p>
</div>
<div class="section" id="mosi-master-out-slave-in">
<span id="mosi-master-out-slave-in"></span><h2>MOSI (Master Out Slave In)<a class="headerlink" href="#mosi-master-out-slave-in" title="Permalink to this headline">¶</a></h2>
<p>This is the line where data is sent from the master device to the slave device. This line is shared by all slave devices.</p>
</div>
<div class="section" id="miso-master-in-slave-out">
<span id="miso-master-in-slave-out"></span><h2>MISO (Master In Slave Out)<a class="headerlink" href="#miso-master-in-slave-out" title="Permalink to this headline">¶</a></h2>
<p>On this line the data is being sent out of the slave device received by master. This line is shared by all slave devices.</p>
</div>
<div class="section" id="cs-ss-chip-select-slave-select">
<span id="cs-ss-chip-select-slave-select"></span><h2>CS/SS (Chip Select / Slave Select)<a class="headerlink" href="#cs-ss-chip-select-slave-select" title="Permalink to this headline">¶</a></h2>
<p>This line is referred to as CS or SS interchangeably. It is active low, which means the slave device is active when CS is set low. Only one CS can be low at a time or there will be conflicts on the SPI bus resulting in garbage data. We use a pull-up resistor on the CS pin to set a default value.</p>
<p>A pull-up resistor is a large resistor (typically 10K) which bridges between VCC (3V3 in our case) and another pin. When no load is applied to the pin, no current flows through the resistor. This allows us to hold CS at a known (3V3) state when the CS pin isn’t being driven by other circuitry. Then, we can drive another pin on the CS line low (GND) to select the device. Current will flow through the resistor and drop 3V3 across it.</p>
</div>
<div class="section" id="hardware-signal">
<span id="hardware-signal"></span><h2>Hardware Signal<a class="headerlink" href="#hardware-signal" title="Permalink to this headline">¶</a></h2>
<p>If you look at the SPI lines on an oscilloscope, this is what a SPI transfer should look like:</p>
<p><img alt="SPI signals on an oscilloscope" src="../_images/spi_scope.png" /></p>
<p>This image is taken from online but SPI transfers look very similar on our equipment.</p>
<p>I’ll pose the following question:</p>
<blockquote>
<div><em>Which lines are which?</em></div></blockquote>
<p>You can’t really distinguish between MISO and MOSI in this picture but just pick one to be MOSI and the other to be MISO. What is being sent and received? The answer is given below.</p>
<blockquote>
<div><p><strong>Answer:</strong></p>
<ol class="simple">
<li>The <strong>yellow line is CS</strong>. This is because it is being lowered before and raised after the SPI transfer is complete.</li>
<li>The <strong>green line is SCK</strong>. It oscillates 8 times for each byte sent.</li>
<li>The <strong>pink and blue are MOSI and MISO</strong>. The blue line has <code class="docutils literal"><span class="pre">0x00</span></code> and <code class="docutils literal"><span class="pre">0x00</span></code> and the pink line has <code class="docutils literal"><span class="pre">0b10010101</span></code> and <code class="docutils literal"><span class="pre">0b01010101</span></code>.</li>
</ol>
</div></blockquote>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="spi-using-spi.html" class="btn btn-neutral float-right" title="Using our SPI Library" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="spi.html" class="btn btn-neutral" title="SPI (Serial Peripheral Interface)" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2018, University of Toronto Aerospace Team.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../',
            VERSION:'1.0',
            LANGUAGE:'None',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true,
            SOURCELINK_SUFFIX: '.txt'
        };
    </script>
      <script type="text/javascript" src="../_static/jquery.js"></script>
      <script type="text/javascript" src="../_static/underscore.js"></script>
      <script type="text/javascript" src="../_static/doctools.js"></script>
      <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

  

  <script type="text/javascript" src="../_static/js/theme.js"></script>

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>