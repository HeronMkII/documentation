
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>Hello World ATMega32M1 &#8212; utatss-documentation 1.0 documentation</title>
    <link rel="stylesheet" href="../_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <script type="text/javascript" src="../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
   
  <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="hello-world-atmega32m1">
<span id="hello-world-atmega32m1"></span><h1>Hello World ATMega32M1<a class="headerlink" href="#hello-world-atmega32m1" title="Permalink to this headline">¶</a></h1>
<p>Now that you’ve installed the AVR toolchain, let’s compile and upload our first
program.</p>
<p>Later on, this compilation and uploading process will be made much less painful
using tools such as Make; for most subsystems, this entire process can be
accomplished using a single command.</p>
<div class="section" id="step-1">
<span id="step-1"></span><h2>Step 1<a class="headerlink" href="#step-1" title="Permalink to this headline">¶</a></h2>
<p>Create a new directory called <code class="docutils literal notranslate"><span class="pre">hello_32m1</span></code> as follows:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ mkdir hello_32m1
</pre></div>
</div>
<p>This will be the root directory of the project. Now enter this directory by running <code class="docutils literal notranslate"><span class="pre">cd</span> <span class="pre">hello_32m1</span></code> and run the following command:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ git init
</pre></div>
</div>
<p>This will initialize Git for this root directory and all sub-directories. You’ll
learn more about what this command is doing soon.</p>
</div>
<div class="section" id="step-2">
<span id="step-2"></span><h2>Step 2<a class="headerlink" href="#step-2" title="Permalink to this headline">¶</a></h2>
<p>Create a new file called <code class="docutils literal notranslate"><span class="pre">hello_world.c</span></code>, and copy the following contents into
the new file:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1">#import &lt;uart/log.h&gt;</span>

<span class="nb">int</span> <span class="n">main</span><span class="p">()</span> <span class="p">{</span>
    <span class="n">init_uart</span><span class="p">();</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Hello ATMega32M1!</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">);</span>
    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>The first line, <code class="docutils literal notranslate"><span class="pre">init_uart();</span></code>, initializes the UART circuitry on the 32M1. UART
stands for Universal Asynchronous Receiver-Transmitter. This allows the 32M1 to
communicate with external peripherals using a serial protocol.</p>
<p>The second line, <code class="docutils literal notranslate"><span class="pre">print(&quot;Hello</span> <span class="pre">ATMega32M1!\n&quot;);</span></code>, send the string “Hello
ATMega32M1” to the UART system to be written to serial output.</p>
<p>The third line returns from the <code class="docutils literal notranslate"><span class="pre">main</span></code> function.</p>
<p>Run <code class="docutils literal notranslate"><span class="pre">$</span> <span class="pre">git</span> <span class="pre">status</span></code> and read the output carefully. Notice that Git has noticed
the new file you’ve created.</p>
</div>
<div class="section" id="step-3">
<span id="step-3"></span><h2>Step 3<a class="headerlink" href="#step-3" title="Permalink to this headline">¶</a></h2>
<p>Download the <code class="docutils literal notranslate"><span class="pre">lib-common</span></code> library by running the following command in the root
directory:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ git submodule add https://github.com/HeronMkII/lib-common
</pre></div>
</div>
<p>Run <code class="docutils literal notranslate"><span class="pre">ls</span></code> in the root directory. Notice a new directory has been added, called
<code class="docutils literal notranslate"><span class="pre">lib-common</span></code>. Explore the contents of this directory by running <code class="docutils literal notranslate"><span class="pre">cd</span> <span class="pre">lib-common</span></code>
(do <em>not</em> modify anything).</p>
<p>This is a library which contains many code components common to all subsystems,
including SPI, UART and CAN functionality.</p>
<p>Before the library is used, it must be built. To do this, make sure you are in
the <code class="docutils literal notranslate"><span class="pre">lib-common</span></code> directory and run</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ make
</pre></div>
</div>
<p>Inspect the <code class="docutils literal notranslate"><span class="pre">lib</span></code> folder in the <code class="docutils literal notranslate"><span class="pre">lib-common</span></code> directory. You should notice many
files ending in <code class="docutils literal notranslate"><span class="pre">.a</span></code>. These are the library files we just generated.</p>
</div>
<div class="section" id="step-4">
<span id="step-4"></span><h2>Step 4<a class="headerlink" href="#step-4" title="Permalink to this headline">¶</a></h2>
<p>We’re now ready to compile our program. Make sure you’re in the root directory,
and run</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ avr-gcc -std=gnu99 -Wall -mmcu=atmega32m1 -c hello_world.c -I./lib-common/include
</pre></div>
</div>
<p>This will create a new <code class="docutils literal notranslate"><span class="pre">hello_world.o</span></code> object file. We must now link this
object file to create an executable. To do this, run</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ avr-gcc -std=gnu99 -Wall -mmcu=atmega32m1 -o hello_world.elf hello_world.o -L./lib-common/lib -luart
</pre></div>
</div>
<p>This will create a new file called <code class="docutils literal notranslate"><span class="pre">hello_world.elf</span></code>; this is a complete
executable file. To upload it onto the 32M1, however, we must format it
in the Intel Hex format. To do this, run</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ avr-objcopy -j .text -j .data -O ihex hello_world.elf hello_world.hex
</pre></div>
</div>
<p>This creates the final executable which we will upload to the 32M1, called
<code class="docutils literal notranslate"><span class="pre">hello_world.hex</span></code>.</p>
</div>
<div class="section" id="step-5">
<span id="step-5"></span><h2>Step 5<a class="headerlink" href="#step-5" title="Permalink to this headline">¶</a></h2>
<p>We’re now ready to upload our hello world executable onto a board.</p>
<p>To do this, you need to connect a 32M1 on a board to your computer using a
programmer. Find a Polulu programmer in the lab, and connect it to an open USB
port on your computer.</p>
<p>We will use <code class="docutils literal notranslate"><span class="pre">avrdude</span></code> to upload our <code class="docutils literal notranslate"><span class="pre">hello_world.hex</span></code> onto the 32M1. To do this,
we need to tell <code class="docutils literal notranslate"><span class="pre">avrdude</span></code> which USB port the programmer is connected to. To find
this out, run</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ ls /dev/tty.usb*
</pre></div>
</div>
<p>This lists all USB devices connected to your computer.</p>
<p>The USB device corresponding to the programmer is almost always the device with
the lowest id. For example, if the command above returns
<code class="docutils literal notranslate"><span class="pre">/dev/tty.usbmodem00100561</span> <span class="pre">/dev/tty.usbmodem00100563</span></code>, the USB port
corresponding to the programmer is <code class="docutils literal notranslate"><span class="pre">/dev/tty.usbmodem00100561</span></code>. Make sure to
remember this port.</p>
<p>Connect power to the VCC pin on the board, and ground the GND pin. Set the
voltage to 3.3 volts. Connect the programmer to the programmer port on the
board. Check that the light on the programmer is green; this means the board is
being powered correctly. If the board has insufficient power, the programmer
will not upload to the board, because this has the potential to corrupt the
MCU’s memory.</p>
<p>Now run the following command, where <code class="docutils literal notranslate"><span class="pre">&lt;port&gt;</span></code> is replaced with the USB port you
found above.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ avrdude -p 32m1 -c stk500 -P &lt;port&gt; -U flash:w:./hello_world.hex
</pre></div>
</div>
<p>This should upload your program onto the 32M1! If this command runs
successfully, congratulations! You’ve just compiled and uploaded your first
program onto the 32M1!</p>
</div>
<div class="section" id="step-6">
<span id="step-6"></span><h2>Step 6<a class="headerlink" href="#step-6" title="Permalink to this headline">¶</a></h2>
<p>To verify that the program is running correctly, first connect the female RX pin on the programmer
via a male to male wire to the MOSI pin on the board. This is wire along which
the serial communication between the 32M1 and your computer will occur.</p>
<p>Now, open CoolTerm. Click the Options icon on the top of the new window. The
default options do not need to be changed. Click the Port dropdown menu and
select the port you identified above. Click OK on the bottom right. Click the
Connect icon. Now, any UART output from the 32M1 should appear on your screen.</p>
<p>Reset the board by pressing the reset button. If all goes well, you should see
the string “Hello world!” appear on your screen!</p>
<p>This process was very time consuming and error prone. We’ll see how we can
simplify this process in the future using tools such as Make.</p>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <h3><a href="../index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Hello World ATMega32M1</a><ul>
<li><a class="reference internal" href="#step-1">Step 1</a></li>
<li><a class="reference internal" href="#step-2">Step 2</a></li>
<li><a class="reference internal" href="#step-3">Step 3</a></li>
<li><a class="reference internal" href="#step-4">Step 4</a></li>
<li><a class="reference internal" href="#step-5">Step 5</a></li>
<li><a class="reference internal" href="#step-6">Step 6</a></li>
</ul>
</li>
</ul>
<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../index.html">Documentation overview</a><ul>
  </ul></li>
</ul>
</div>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="../_sources/getting-started/hello-world.md.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    </div>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2018, University of Toronto Aerospace Team [D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[C[D[D[D[D[D[D[D[D[D[D[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C): University of Toronto Aerospace Team.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 1.7.4</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.10</a>
      
      |
      <a href="../_sources/getting-started/hello-world.md.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>